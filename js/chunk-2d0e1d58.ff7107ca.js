(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0e1d58"],{"7bb9":function(s,t,a){"use strict";a.r(t);var n=function(){var s=this,t=s.$createElement;s._self._c;return s._m(0)},e=[function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("section",[a("p",[s._v("React钩子(Hooks)是"),a("code",{pre:!0},[s._v("React 16.8")]),s._v("新增的功能，并且完全向后兼容(backwards-compatible, i.e. 不会有任何重大变化)，让我们可以在函数组件(function component)内使用"),a("code",{pre:!0},[s._v("state")]),s._v("和其他React的特性。\n"),a("em",[s._v("Effect")]),s._v("钩子让我们可以在函数组件内进行抓取数据、订阅事件、改变DOM等等会产生"),a("em",[s._v("副作用")]),s._v("的事件，ta的作用相当于"),a("code",{pre:!0},[s._v("componentDidMount")]),s._v("，"),a("code",{pre:!0},[s._v("componentDidUpdate")]),s._v("，和"),a("code",{pre:!0},[s._v("componentWillUnmount")]),s._v("三者合一，即ta的代码会在每次render后都被执行。")]),a("h3",[s._v("为什么要用Hooks？")]),a("p",[s._v("复杂组件里的状态逻辑和副作用(诸如数据获取、HTTP请求等)堆叠，导致难以维护：")]),a("ul",[a("li",[s._v("组件内的"),a("code",{pre:!0},[s._v("componentDidMount")]),s._v("和"),a("code",{pre:!0},[s._v("componentDidUpdate")]),s._v("方法可能操作相同的代码")]),a("li",[s._v("在同一个方法里可能存在不同功用、逻辑不关联的方法")])]),a("p",[a("strong",[s._v("而Hooks可以实现把逻辑相关、功能一致的代码放在一起。")])]),a("h3",[s._v("Syntax:")]),a("pre",{pre:!0},[a("code",{pre:!0,attrs:{"v-pre":"",class:"language-JavaScript"}},[a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("import")]),s._v(" React, { useState, useEffect } "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("from")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'react'")]),s._v(";\n\n"),a("span",{pre:!0,attrs:{class:"hljs-function"}},[a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-title"}},[s._v("funcComp")]),s._v("("),a("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(") ")]),s._v("{\n  "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("const")]),s._v(" [count, setCount] = useState("),a("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("0")]),s._v("); "),a("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//与useState连用，在useEffect函数体内通过闭包直接获取state里的变量")]),s._v("\n\n  useEffect("),a("span",{pre:!0,attrs:{class:"hljs-function"}},[a("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("()")]),s._v(" =>")]),s._v(" {\n    "),a("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("document")]),s._v(".title = "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("`You clicked "),a("span",{pre:!0,attrs:{class:"hljs-subst"}},[s._v("${count}")]),s._v(" times`")]),s._v(";\n    "),a("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//其他操作，如发请求")]),s._v("\n  })\n\n  "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" (\n    "),a("span",{pre:!0,attrs:{class:"xml"}},[a("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("<"),a("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("div")]),s._v(">")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("<"),a("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("p")]),s._v(">")]),s._v("It is {count} times"),a("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("</"),a("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("p")]),s._v(">")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("<"),a("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("button")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("onClick")]),s._v("="),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("{()")]),s._v(" =>")]),s._v(" setCount(count+1)}> /* 类似setState，里面接收最新的state的值 */\n        Click\n      "),a("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("</"),a("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("button")]),s._v(">")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("</"),a("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("div")]),s._v(">")])]),s._v("\n  )\n}\n")])]),a("p",[s._v("以下例子在"),a("code",{pre:!0},[s._v("useEffect")]),s._v("函数体内订阅事件(subscribe to an event)，并可以返回一个取消订阅的操作，React会在"),a("code",{pre:!0},[s._v("componentWillUnmount")]),s._v("(i.e. 需要清理timer等事件监听)的时候执行这个返回的函数：")]),a("pre",{pre:!0},[a("code",{pre:!0,attrs:{"v-pre":"",class:"language-JavaScript"}},[a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("import")]),s._v(" React, { useState, useEffect } "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("from")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'react'")]),s._v(";\n\n"),a("span",{pre:!0,attrs:{class:"hljs-function"}},[a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-title"}},[s._v("FriendStatus")]),s._v("("),a("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("props")]),s._v(") ")]),s._v("{\n  "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("const")]),s._v(" [isOnline, setIsOnline] = useState("),a("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("null")]),s._v(");\n\n  useEffect("),a("span",{pre:!0,attrs:{class:"hljs-function"}},[a("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("()")]),s._v(" =>")]),s._v(" {\n    "),a("span",{pre:!0,attrs:{class:"hljs-function"}},[a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-title"}},[s._v("handleStatusChange")]),s._v("("),a("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("status")]),s._v(") ")]),s._v("{\n      setIsOnline(status.isOnline);\n    }\n\n    ChatAPI.subscribeToFriendStatus(props.friend.id, handleStatusChange);\n    "),a("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 返回的函数会在React撤销挂载页面时执行")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-function"}},[a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-title"}},[s._v("cleanup")]),s._v("("),a("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(") ")]),s._v("{ "),a("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//这是可选的")]),s._v("\n      ChatAPI.unsubscribeFromFriendStatus(props.friend.id, handleStatusChange);\n    };\n  });\n\n  "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" (isOnline === "),a("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("null")]),s._v(") {\n    "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'Loading...'")]),s._v(";\n  }\n  "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" isOnline ? "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'Online'")]),s._v(" : "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'Offline'")]),s._v(";\n}\n")])]),a("h3",[s._v("Tips:")]),a("ul",[a("li",[s._v("跳过Effect来提高性能\n因为每次render都会执行一遍useEffect，而在一个组件中可能存在好几个useEffect，如果一个useEffect里没有用到某个个state里的变量，那每次render都执行会影响性能，这时可以在useEffect传入"),a("strong",[s._v("第二个参数")]),s._v("。第二个参数为"),a("em",[s._v("数组")]),s._v("，传入的元素为会被检测是否相同的变量：")])]),a("pre",{pre:!0},[a("code",{pre:!0,attrs:{"v-pre":"",class:"language-JavaScript"}},[s._v("useEffect("),a("span",{pre:!0,attrs:{class:"hljs-function"}},[a("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("()")]),s._v("=>")]),s._v("{\n  "),a("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("document")]),s._v(".title = "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("`You clicked "),a("span",{pre:!0,attrs:{class:"hljs-subst"}},[s._v("${count}")]),s._v(" times`")]),s._v(";\n},[count]); "),a("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//只有在count变化的时候才会执行这个useEffect")]),s._v("\n")])]),a("p",[s._v("Note: 如果希望useEffect只在挂载和撤销挂载(Unmount)的时候执行，可传一个空数组"),a("code",{pre:!0},[s._v("[]")])]),a("ul",[a("li",[s._v("只能在top-level处使用Hooks")])]),a("h3",[s._v("自定义Hooks")]),a("p",[s._v("类似一个组件的定义，只是里面只包含该Hook的逻辑：")]),a("pre",{pre:!0},[a("code",{pre:!0,attrs:{"v-pre":"",class:"language-JavaScript"}},[a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("import")]),s._v(" React, { useState, useEffect } "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("from")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'react'")]),s._v(";\n\n"),a("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//自定义Hook - useFriendStatus")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//通常以'use-'开头命名")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"hljs-function"}},[a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-title"}},[s._v("useFriendStatus")]),s._v("("),a("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("friendID")]),s._v(") ")]),s._v("{\n  "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("const")]),s._v(" [isOnline, setIsOnline] = useState("),a("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("null")]),s._v(");\n\n  "),a("span",{pre:!0,attrs:{class:"hljs-function"}},[a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-title"}},[s._v("handleStatusChange")]),s._v("("),a("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("status")]),s._v(") ")]),s._v("{\n    setIsOnline(status.isOnline);\n  }\n\n  useEffect("),a("span",{pre:!0,attrs:{class:"hljs-function"}},[a("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("()")]),s._v(" =>")]),s._v(" {\n    ChatAPI.subscribeToFriendStatus(friendID, handleStatusChange);\n    "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-function"}},[a("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("()")]),s._v(" =>")]),s._v(" {\n      ChatAPI.unsubscribeFromFriendStatus(friendID, handleStatusChange);\n    };\n  });\n\n  "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" isOnline;\n}\n\n"),a("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//在其他组件内使用Hook")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"hljs-function"}},[a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-title"}},[s._v("FriendListItem")]),s._v("("),a("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("props")]),s._v(") ")]),s._v("{\n  "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("const")]),s._v(" isOnline = useFriendStatus(props.friend.id);\n\n  "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" (\n    "),a("span",{pre:!0,attrs:{class:"xml"}},[a("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("<"),a("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("li")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("style")]),s._v("="),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("{{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("color:")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("isOnline")]),s._v(" ? '"),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("green")]),s._v("' "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v(":")]),s._v(" '"),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("black")]),s._v("' }}>")]),s._v("\n      {props.friend.name}\n    "),a("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("</"),a("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("li")]),s._v(">")])]),s._v("\n  );\n}\n")])])])}],r=a("2877"),l={},p=Object(r["a"])(l,n,e,!1,null,null,null);t["default"]=p.exports}}]);
//# sourceMappingURL=chunk-2d0e1d58.ff7107ca.js.map