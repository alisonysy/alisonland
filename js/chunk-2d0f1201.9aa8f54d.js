(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0f1201"],{"9efe":function(s,a,r){"use strict";r.r(a);var t=function(){var s=this,a=s.$createElement;s._self._c;return s._m(0)},n=[function(){var s=this,a=s.$createElement,r=s._self._c||a;return r("section",[r("h2",[s._v("装饰器 - decorator")]),r("p",[s._v("装饰器是一个接收另一个函数并改变他原函数行为的封装函数。")]),r("p",[r("strong",[s._v("装饰器的优势")]),s._v("：")]),r("ul",[r("li",[s._v("可重复利用")]),r("li",[s._v("逻辑是独立的，与接收到的函数互不影响")]),r("li",[s._v("可以组合其他装饰器一起使用")])]),r("p",[r("strong",[s._v("装饰器的不足")]),s._v("：")]),r("ul",[r("li",[s._v("若原函数有自身的属性，装饰器返回的封装函数将不会有这些属性，但可以通过创建一个"),r("code",{pre:!0},[s._v("Proxy")]),s._v("对象把属性包含进去")])]),r("p",[s._v("e.g. 缓存装饰器")]),r("pre",{pre:!0},[r("code",{pre:!0,attrs:{"v-pre":"",class:"language-js"}},[r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-title"}},[s._v("cachingDecorator")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("func")]),s._v(") ")]),s._v("{\n  "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" cache = "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("new")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("Map")]),s._v("();\n\n  "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("x")]),s._v(") ")]),s._v("{\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" (cache.has(x)) {    "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// if there's such key in cache")]),s._v("\n      "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" cache.get(x); "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// read the result from it")]),s._v("\n    }\n\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" result = func(x);  "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// otherwise call func")]),s._v("\n\n    cache.set(x, result);  "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// and cache (remember) the result")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" result;\n  };\n}\n")])]),r("p",[s._v("他返回的是一个缓存的封装函数，以便各种函数都可以使用。")]),r("p",[s._v("当原函数为一个"),r("em",[s._v("对象里的方法")]),s._v("，并且有使用"),r("code",{pre:!0},[s._v("this")]),s._v("时，装饰器返回的wrapper function里调用原函数时需要用到"),r("code",{pre:!0},[s._v("func.call(context[,arg[0],arg[1],...arg[n]])")]),s._v("或"),r("code",{pre:!0},[s._v("func.apply(context,args)")]),s._v("。\ne.g.")]),r("pre",{pre:!0},[r("code",{pre:!0,attrs:{"v-pre":"",class:"language-js"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" o = {\n  method(arg1,arg2){\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" arg1 + arg2;\n  }\n}\n\n"),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-title"}},[s._v("cachingDecorator")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("func, hash")]),s._v(") ")]),s._v("{\n  "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" cache = "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("new")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("Map")]),s._v("();\n  "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(") ")]),s._v("{\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" key = hash("),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("arguments")]),s._v("); "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 当原函数接收多个参数时，设置缓存key可以是这些参数的集合")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" (cache.has(key)) {\n      "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" cache.get(key);\n    }\n\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" result = func.call("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(", ...arguments); "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 或是func.apply(this, arguments)；此处直接使用this是因为函数调用时的this指向o对象")]),s._v("\n\n    cache.set(key, result);\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" result;\n  };\n}\n\n"),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-title"}},[s._v("hash")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("args")]),s._v(") ")]),s._v("{ "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// arguments是一个数组或类数组")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" [].join.call(args); "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//[].join.call()是把一个数组中的join方法通过call应用到另一个对象上，该对象必须有0, 1, 2, ...n的属性，以及length")]),s._v("\n}\n\nworker.slow = cachingDecorator(worker.slow, hash);\n")])]),r("h3",[s._v("其他例子")]),r("h4",[s._v("spy decorator")]),r("p",[s._v("保存每次调用的函数的参数，可用于单元测试")]),r("pre",{pre:!0},[r("code",{pre:!0,attrs:{"v-pre":"",class:"language-js"}},[r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-title"}},[s._v("spy")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("func")]),s._v(") ")]),s._v("{\n  "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("const")]),s._v(" inner = "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(")")]),s._v("{\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" args = [];\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("for")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" n="),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("0")]),s._v(";n<"),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("arguments")]),s._v(".length;n++){\n      args.push("),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("arguments")]),s._v("[n]);\n    }\n    inner.calls.push(args);\n    \n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" func.apply("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(","),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("arguments")]),s._v(");\n  }\n  inner.calls = []; "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 初始化函数inner的属性，该属性应设置在返回的函数身上")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" inner;\n}\n\n"),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-title"}},[s._v("work")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("a, b")]),s._v(") ")]),s._v("{\n  alert( a + b ); "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// work is an arbitrary function or method")]),s._v("\n}\n\nwork = spy(work);\n\nwork("),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("1")]),s._v(", "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("2")]),s._v("); "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 3")]),s._v("\nwork("),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("4")]),s._v(", "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("5")]),s._v("); "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 9")]),s._v("\n\n"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("for")]),s._v(" ("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" args "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("of")]),s._v(" work.calls) {\n  alert( "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'call:'")]),s._v(" + args.join() ); "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v('// "call:1,2", "call:4,5"')]),s._v("\n}\n")])])])}],e=r("2877"),l={},p=Object(e["a"])(l,t,n,!1,null,null,null);a["default"]=p.exports}}]);
//# sourceMappingURL=chunk-2d0f1201.9aa8f54d.js.map