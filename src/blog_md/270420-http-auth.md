## HTTP 权限控制和身份校验

### Basic authentication
关于前端鉴权的多种方式，首先要提及的是**HTTP Basic authentication**。HTTP提供了一个用于权限控制和认证的通用框架。

1. 服务器可以用来针对客户端的请求质询信息
2. 客户端用来提供身份验证凭证

#### 流程
信息的交换必须通过*HTTPS(TLS)*连接来保证安全。
1. 客户端发送资源请求
2. 服务端返回401表示客户端未被授权，并在返回的字段首部`WWW-Authenticate`提供如何验证的信息
3. 客户端在请求中添加`Authentication`首部字段，值为身份凭证信息

### Token验证

#### Single Signed-On (SSO) 单点登录验证
场景：**跨域认证** － 应用有多个域名之间希望共享登录信息，用户在其中1个域名登录过一次后，在其他域名无需重复登录。使用传统的*session-cookie*无法解决，因为鉴于浏览器的同源政策，cookie只能在他被创建的域名下获取。
而SSO通过在一个中间域名下进行身份验证，然后把验证信息与其他域名共享来达到目的。

**流程**
1. 当客户端求资源
2. 服务端检测到请求没有身份信息，重定向到进行身份验证的域名
3. 客户端进行身份验证成功，被重定向到原来请求资源的域名并接收到身份信息的token，这个token包含所有可以进行身份验证的信息
4. 当客户端新进入到需要身份验证的域名时，会带上之前下发的token，会被重定向到进行身份验证的域名，该域名检测到客户端的token，验证通过重定向到要求进入的新域名

#### JWT (JSON Web Token)
JWT是实现跨域认证的一种解决方案，可用于SSO单点登录。以往的用户登录信息都以session的形式保存在服务器上，而JWT则让客户端保存，每次请求都返回服务器。

**缺点**：
+ 由于服务器不保存session状态，导致无法在使用过程中废止某个已经签发的token
+ JWT本身包含了认证信息，一旦泄露，任何人都可以获得该token的所有权限，应该设置较短的有效期，对于较为重要的权限应该再次认证

**流程**
1. 服务器A认证了用户信息后，生成JSON对象，通过*Base64URL*转换和添加签名后得到JWT字符串，返回给客户端
2. 客户端登录跨域的关联服务，带上JWT信息(通常放在请求中)发送给服务器B
3. 服务器A和服务器B因为是关联的，共享用于签名的密钥，此时服务器B通过密钥解密JWT信息，认证用户身份
*注*：Base64URL与Base64算法有不同，Base64URL会把`=`省略，`+`替换成`-`，`/`替换成`_`

**组成**
`header.payload.signature`
*header*：是一个JSON对象，描述JWT的元数据
```json
{
  "alg":"HS256", //签名的算法
  "typ":"JWT" // token的类型
}
```

*payload*：是一个JSON对象，存放用户身份信息，JWT规定了7个官方的字段，包括
+ iss 签发人
+ exp 过期时间
+ sub 主题
+ aud 受众
+ nbf 生效时间
+ iat 签发时间
+ jti 编号

另外，还支持定义私有字段

*signature*：对前两部分进行签名，防止数据篡改。使用*header*指定的算法，按照以下公式产生签名：
```js
HMACSHA256( //算法加密方法
  base64UrlEncode(header) + '.' +
  base64UrlEncode(payload),
  secret
)
```
然后把header，payload，signature三部分拼成一个字符串并用`.`分隔再返回给用户