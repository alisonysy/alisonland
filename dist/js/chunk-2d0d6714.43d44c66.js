(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0d6714"],{7324:function(s,a,t){"use strict";t.r(a);var n=function(){var s=this,a=s.$createElement;s._self._c;return s._m(0)},r=[function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("section",[t("p",[s._v("Event bus采用的是发布/订阅模式，常用于小到中型app里组件的解耦(decoupling)。下面是用JavaScript手写一个event bus的例子。")]),t("p",[s._v("既然是"),t("strong",[s._v("发布/订阅")]),s._v("模式，即有：订阅者(subscriber)、发布者(publisher)和事件(events)三大块。")]),t("h3",[s._v("把不同类型的事件和对应要执行的callback放到一个对象里")]),t("pre",{pre:!0},[t("code",{pre:!0,attrs:{"v-pre":"",class:"language-js"}},[t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("const")]),s._v(" subscriptions = {}\n")])]),t("p",[s._v("一开始的对象为空，当有事件被订阅时，会在此对象上添加，同时应该对对象里每个订阅事件的函数赋予ID，用于unsubscribe，最后理想的"),t("code",{pre:!0},[s._v("subscriptions")]),s._v("对象是：")]),t("pre",{pre:!0},[t("code",{pre:!0,attrs:{"v-pre":"",class:"language-js"}},[s._v("subscriptions ={\n  "),t("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("eventType1")]),s._v(":{\n    "),t("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("id1")]),s._v(": func1,\n    "),t("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("id2")]),s._v(": func2,\n    ...\n  },\n  "),t("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("eventType2")]),s._v(":{\n    "),t("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("id1")]),s._v(": func1,\n    "),t("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("id2")]),s._v(": func2,\n    ...\n  }\n}\n")])]),t("h3",[s._v("订阅函数——指明要订阅的事件和callback")]),t("p",[s._v("订阅函数需要对初次注册的callback赋予ID，同时返回"),t("code",{pre:!0},[s._v("unsubscribe")]),s._v("方法。\n"),t("strong",[s._v("ID生成函数")]),s._v("：")]),t("pre",{pre:!0},[t("code",{pre:!0,attrs:{"v-pre":"",class:"language-js"}},[t("span",{pre:!0,attrs:{class:"hljs-function"}},[t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"hljs-title"}},[s._v("idGenerator")]),s._v("("),t("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(")")]),s._v("{\n  "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" lastIndex = "),t("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("0")]),s._v(";\n  "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"hljs-function"}},[t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"hljs-title"}},[s._v("getIndex")]),s._v("("),t("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(")")]),s._v("{ "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//闭包用于记录上一次的lastIndex")]),s._v("\n    lastIndex += "),t("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("1")]),s._v(";\n    "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" lastIndex\n  }\n}\n"),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("const")]),s._v(" getIndex = idGenerator()\n")])]),t("pre",{pre:!0},[t("code",{pre:!0,attrs:{"v-pre":"",class:"language-js"}},[t("span",{pre:!0,attrs:{class:"hljs-function"}},[t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"hljs-title"}},[s._v("subscribe")]),s._v("("),t("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("eventType, fn")]),s._v(")")]),s._v("{\n  "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("const")]),s._v(" id = getIndex(); "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//调用的是idGenerator()返回的函数，调用并不会执行`let lastIndex = 0;`，同时getIndex()包含之前的lastIndex的信息")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v("(!subscriptions[eventType]){\n    subscriptions[eventType] = {}\n  }\n  subscriptions[eventType][id] = fn\n\n  "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" {\n    "),t("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("unsubscribe")]),s._v(": "),t("span",{pre:!0,attrs:{class:"hljs-function"}},[t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),t("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(")")]),s._v("{\n      "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("delete")]),s._v(" subscriptions[eventType][id]\n      "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//当一个事件类型没有订阅者时，删除该事件类型")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v("(!"),t("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("Object")]),s._v(".keys(subscriptions[eventType])){\n        "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("delete")]),s._v(" subscriptions[eventType]\n      }\n    }\n  }\n}\n")])]),t("h3",[s._v("发布函数——指明发布的事件和输出的参数")]),t("pre",{pre:!0},[t("code",{pre:!0,attrs:{"v-pre":"",class:"language-js"}},[t("span",{pre:!0,attrs:{class:"hljs-function"}},[t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"hljs-title"}},[s._v("publish")]),s._v("("),t("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("eventType, data")]),s._v(")")]),s._v("{\n  "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v("(!subscriptions[eventType]){\n    "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v("\n  }\n\n  "),t("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("Object")]),s._v(".keys(subscriptions[eventType]).map("),t("span",{pre:!0,attrs:{class:"hljs-function"}},[s._v("("),t("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("entry")]),s._v(")=>")]),s._v("{\n    subscriptions[eventType][entry].call("),t("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("undefined")]),s._v(",data)\n  })\n}\n")])]),t("h3",[s._v("完整模块输出代码")]),t("pre",{pre:!0},[t("code",{pre:!0,attrs:{"v-pre":"",class:"language-js"}},[t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("const")]),s._v(" subscriptions = {};\n"),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("const")]),s._v(" getIndex = idGenerator();\n\n"),t("span",{pre:!0,attrs:{class:"hljs-function"}},[t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"hljs-title"}},[s._v("idGenerator")]),s._v("("),t("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(")")]),s._v("{\n  "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" lastIndex = "),t("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("0")]),s._v(";\n  "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"hljs-function"}},[t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"hljs-title"}},[s._v("getIndex")]),s._v("("),t("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(")")]),s._v("{ "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//闭包用于记录上一次的lastIndex")]),s._v("\n    lastIndex += "),t("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("1")]),s._v(";\n    "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" lastIndex\n  }\n}\n\n"),t("span",{pre:!0,attrs:{class:"hljs-function"}},[t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"hljs-title"}},[s._v("subscribe")]),s._v("("),t("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("eventType, fn")]),s._v(")")]),s._v("{\n  "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("const")]),s._v(" id = getIndex(); "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//调用的是idGenerator()返回的函数，调用并不会执行`let lastIndex = 0;`，同时getIndex()包含之前的lastIndex的信息")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v("(!subscriptions[eventType]){\n    subscriptions[eventType] = {}\n  }\n  subscriptions[eventType][id] = fn\n\n  "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" {\n    "),t("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("unsubscribe")]),s._v(": "),t("span",{pre:!0,attrs:{class:"hljs-function"}},[t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),t("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(")")]),s._v("{\n      "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("delete")]),s._v(" subscriptions[eventType][id]\n      "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//当一个事件类型没有订阅者时，删除该事件类型")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v("(!"),t("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("Object")]),s._v(".keys(subscriptions[eventType])){\n        "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("delete")]),s._v(" subscriptions[eventType]\n      }\n    }\n  }\n}\n\n"),t("span",{pre:!0,attrs:{class:"hljs-function"}},[t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"hljs-title"}},[s._v("publish")]),s._v("("),t("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("eventType, data")]),s._v(")")]),s._v("{\n  "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v("(!subscriptions[eventType]){\n    "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v("\n  }\n\n  "),t("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("Object")]),s._v(".keys(subscriptions[eventType]).map("),t("span",{pre:!0,attrs:{class:"hljs-function"}},[s._v("("),t("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("entry")]),s._v(")=>")]),s._v("{\n    subscriptions[eventType][entry].call("),t("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("undefined")]),s._v(",data)\n  })\n}\n\n"),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("export")]),s._v(" {subscriptions,publish,subscribe} \n")])]),t("h3",[s._v("使用")]),t("p",[s._v("import的时候，可作为单个方法引入，也可设置namespace。")]),t("ul",[t("li",[s._v("单个方法引入：")])]),t("pre",{pre:!0},[t("code",{pre:!0,attrs:{"v-pre":"",class:"language-js"}},[t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("import")]),s._v(" {subscribe, publish, subscriptions} "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("from")]),s._v(" "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'./main1.js'")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" a = subscribe("),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"loaded"')]),s._v(","),t("span",{pre:!0,attrs:{class:"hljs-function"}},[t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),t("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("args")]),s._v(")")]),s._v("{\n  "),t("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("console")]),s._v(".log("),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'doc is loaded, here is the args:'")]),s._v("+args)\n});\n\n"),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//some other codes")]),s._v("\n\npublish("),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"loaded"')]),s._v(","),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"I\'m the arg."')]),s._v(")\n\n"),t("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("console")]),s._v(".log(subscriptions["),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"loaded"')]),s._v("]["),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"1"')]),s._v("]); "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//打印出注册的函数")]),s._v("\n\na.unsubscribe();\n\n"),t("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("console")]),s._v(".log(subscriptions["),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"loaded"')]),s._v("]["),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"1"')]),s._v("]); "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//undefined")]),s._v("\n")])]),t("ul",[t("li",[s._v("用eventBus作为命名空间：")])]),t("pre",{pre:!0},[t("code",{pre:!0,attrs:{"v-pre":"",class:"language-JavaScript"}},[t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("import")]),s._v(" * "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("as")]),s._v(" eventBus "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("from")]),s._v(" "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'./main1.js'")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" a = eventBus.subscribe("),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"loaded"')]),s._v(","),t("span",{pre:!0,attrs:{class:"hljs-function"}},[t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),t("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("args")]),s._v(")")]),s._v("{\n  "),t("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("console")]),s._v(".log("),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'doc is loaded, here is the args:'")]),s._v("+args)\n});\n\n"),t("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("console")]),s._v(".log("),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'subscribed'")]),s._v(")\n\n"),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//some other codes")]),s._v("\neventBus.publish("),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"loaded"')]),s._v(","),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"I\'m the arg."')]),s._v(")\n\n"),t("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("console")]),s._v(".log(eventBus.subscriptions["),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"loaded"')]),s._v("]["),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"1"')]),s._v("]);\n\na.unsubscribe();\n\n"),t("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("console")]),s._v(".log(eventBus.subscriptions["),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"loaded"')]),s._v("]["),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"1"')]),s._v("]);\n")])])])}],e=t("2877"),p={},l=Object(e["a"])(p,n,r,!1,null,null,null);a["default"]=l.exports}}]);
//# sourceMappingURL=chunk-2d0d6714.43d44c66.js.map